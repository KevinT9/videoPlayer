<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Video</title>
    <style>
        body{
            font-family: Arial, sans-serif;
            background-color: darkgrey;
        }
        h1 {
            text-align: center;
        }

        #videoPlayer {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>

<h1>Reproductor de Video</h1>

<p>Sesión actual: <span id="sessionId" th:text="${sesion.getSessionId()}"></span></p>

<!-- Reproductor de video -->
<section id="videoPlayerContainer">
    <video id="videoPlayer" width="800" controls>
        <source id="videoSource" type="video/mp4">
        Tu navegador no soporta el formato de video.
    </video>
</section>

<br>

<script>
    // Generamos un ID único de sesión en el cliente
    const sessionId = "session-" + Math.random().toString(36).substr(2, 9); // Genera un ID único simple
    document.getElementById("sessionId").innerText = sessionId; // Mostramos el ID en el HTML

    // Conectar al WebSocket
    const socket = new WebSocket('wss://loves-sharp-hall-bridge.trycloudflare.com/ws/video');

    // Cuando el WebSocket esté abierto, el cliente está listo para recibir mensajes
    socket.onopen = function () {
        console.log('Conectado al WebSocket');
        // Enviar el ID de sesión al servidor después de que la conexión esté abierta
        socket.send(JSON.stringify({ type: "registerSession", sessionId: sessionId }));
    };

    // Función para recibir la URL del video desde el servidor
    socket.onmessage = function (event) {
        const videoUrl = event.data;  // La URL del video que el servidor envió
        console.log('Reproduciendo video desde URL: ', videoUrl);
        const videoElement = document.getElementById("videoPlayer");
        const videoSource = document.getElementById("videoSource");
        videoSource.src = videoUrl;  // Establece la fuente del video
        videoElement.volume = 0.3;   // Establece el volumen del video al 50%
        videoElement.load();         // Carga el video
        videoElement.play();         // Reproduce el video
    };

    // Si ocurre algún error en la conexión WebSocket
    socket.onerror = function (error) {
        console.error('Error de WebSocket: ', error);
    };

    // Si se cierra la conexión WebSocket
    socket.onclose = function () {
        console.log('Conexión WebSocket cerrada');
    };
</script>

</body>
</html>
